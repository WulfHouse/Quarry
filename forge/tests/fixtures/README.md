# Test Fixtures

This directory contains shared test fixtures and data files.

## Structure

- `golden/` - Golden files for snapshot testing
  - Deterministic reference outputs
  - Update with: `pytest --update-goldens` (when implemented)
  
- `snapshots/` - Test snapshots
  - JSON snapshots with sorted keys for determinism
  - Generated by tests, reviewed in PRs

## Usage

### Golden Files

Golden files are reference outputs that tests compare against. They should be:
- Deterministic (same input â†’ same output)
- Version controlled
- Reviewed when changed

Example:
```python
def test_lexer_output(sample_source):
    tokens = lex(sample_source)
    golden_file = Path(__file__).parent / "fixtures" / "golden" / "simple_tokens.json"
    expected = json.loads(golden_file.read_text())
    assert tokens == expected
```

### Snapshots

Snapshots capture test outputs for comparison. They should be:
- JSON format with sorted keys
- Deterministic serialization
- Updated when behavior intentionally changes

Example:
```python
def test_ast_structure(sample_ast):
    snapshot = json.dumps(sample_ast, sort_keys=True, indent=2)
    snapshot_file = Path(__file__).parent / "fixtures" / "snapshots" / "simple_ast.json"
    if snapshot_file.exists():
        expected = snapshot_file.read_text()
        assert snapshot == expected
    else:
        snapshot_file.write_text(snapshot)
```

## Fixtures in conftest.py

Standard fixtures available to all tests:
- `temp_dir` - Deterministic temp directory
- `sample_source` - Small Pyrite source code
- `sample_tokens` - Pre-lexed tokens
- `sample_ast` - Pre-parsed AST
- `repo_root` - Repository root path
- `compiler_dir` - forge directory
- `examples_dir` - Examples directory
