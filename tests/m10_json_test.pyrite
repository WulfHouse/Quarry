# M10 JSON Test

import std.serialize.json
import std.core.serialize

struct User:
    name: String
    age: i64

impl Serialize for User:
    fn serialize[S: Serializer](&self, s: &mut S) -> Result[bool, String]:
        s.serialize_map_start(2)?
        s.serialize_str("name")?
        s.serialize_str(self.name)?
        s.serialize_str("age")?
        s.serialize_i64(self.age)?
        s.serialize_map_end()?
        return Ok(true)

fn main() -> int:
    let user = User { name: "Alice", age: 30 }
    match to_string(&user):
        Ok(s):
            print(s)
            print("JSON test passed!")
            return 0
        Err(e):
            print("JSON error")
            return 1
